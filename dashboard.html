<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Portal | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to bottom, #F5F5F5, #E8F5E9);
            color: #2E2E2E;
            min-height: 100vh;
            line-height: 1.6;
            display: flex;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background-color: #4CAF50;
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(255,255,255,0.1);
        }

        .nav-item i {
            font-size: 1.2rem;
            width: 25px;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 30px;
            width: calc(100% - 250px);
        }

        .page-header {
            background-color: #FFFFFF;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.8rem;
            color: #4CAF50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #8BC34A;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        /* Plantix-style Weather Card */
        .weather-card {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .weather-location {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2E2E2E;
            margin-bottom: 5px;
        }

        .weather-date {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .weather-temp {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4CAF50;
        }

        .weather-details {
            text-align: right;
        }

        .weather-condition {
            font-size: 1.1rem;
            color: #2E2E2E;
            margin-bottom: 5px;
        }

        .weather-range {
            color: #666;
            font-size: 0.9rem;
        }

        /* Feature Cards */
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .feature-card {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .feature-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #E8F5E9;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4CAF50;
            font-size: 1.5rem;
        }

        .feature-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.3rem;
            color: #2E2E2E;
        }

        .feature-desc {
            color: #666;
            margin-bottom: 15px;
        }

        .feature-list {
            list-style: none;
            margin-top: 15px;
        }

        .feature-list li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-list i {
            color: #4CAF50;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2E2E2E;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
            font-family: 'Roboto', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3d8b40;
        }

        .btn-secondary {
            background-color: #FFD700;
            color: #2E2E2E;
        }

        .btn-secondary:hover {
            background-color: #e6c200;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid #4CAF50;
            color: #4CAF50;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Unavailable Page */
        .unavailable-page {
            display: none;
            text-align: center;
            padding: 50px 20px;
        }

        .unavailable-icon {
            font-size: 5rem;
            color: #8BC34A;
            margin-bottom: 20px;
        }

        .unavailable-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 2rem;
            margin-bottom: 15px;
            color: #2E2E2E;
        }

        .unavailable-text {
            color: #666;
            margin-bottom: 30px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Results Section */
        .results {
            background-color: #F5F5F5;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .results.active {
            display: block;
        }

        .result-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .result-title {
            font-weight: 600;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        /* Video Grid */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background-color: #F5F5F5;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .video-card:hover {
            transform: translateY(-5px);
        }

        .video-thumbnail {
            width: 100%;
            height: 120px;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            position: relative;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
            height: 40px;
            overflow: hidden;
        }

        .video-meta {
            font-size: 0.8rem;
            color: #666;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #FFFFFF;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            color: #2E2E2E;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Tips Section */
        .tips-section {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background-color: #F5F5F5;
            border-radius: 8px;
        }

        .tip-item {
            padding: 10px;
            margin-bottom: 10px;
            background-color: white;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
        }

        .tip-title {
            font-weight: 600;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        /* Row and Column Layout */
        .row {
            display: flex;
            gap: 10px;
        }

        .col {
            flex: 1;
        }

        /* Calculator Sections */
        .calculator-section {
            display: none;
            margin-top: 30px;
        }

        .calculator-section.active {
            display: block;
        }

        /* Chat Widget Toggle */

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .logo h1, .nav-item span {
                display: none;
            }
            
            .nav-item {
                justify-content: center;
                padding: 15px 0;
            }
            
            .main-content {
                margin-left: 70px;
                width: calc(100% - 70px);
                padding: 15px;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .weather-card {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .weather-details {
                text-align: center;
            }
            
            .row {
                flex-direction: column;
            }
            
            .chat-widget-toggle {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }
            
            .feature-card, .weather-card {
                padding: 20px;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="logo">
            <h1><i class="fas fa-seedling"></i> Farmer Portal</h1>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" data-page="home">
                <i class="fas fa-tractor"></i>
                <span>Your Crops</span>
            </li>
            <li class="nav-item" data-page="disease">
                <i class="fas fa-heartbeat"></i>
                <span>Heal Your Crops</span>
            </li>
            <li class="nav-item" data-page="community">
                <i class="fas fa-users"></i>
                <span>Community</span>
            </li>
            <li class="nav-item" data-page="market">
                <i class="fas fa-shopping-cart"></i>
                <span>Market</span>
            </li>
            <li class="nav-item" data-page="profile">
                <i class="fas fa-user"></i>
                <span>You</span>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Home Page -->
        <div id="homePage" class="page">
            <div class="page-header">
                <h1 class="page-title">Your Crops Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div class="user-name">Welcome, Farmer!</div>
                        <div class="user-status" id="userLocation">Detecting your location...</div>
                    </div>
                </div>
            </div>

            <!-- Weather Card (Plantix Style) with Dynamic Date -->
            <div class="weather-card">
                <div class="weather-main">
                    <div class="weather-location" id="currentLocation">Detecting location...</div>
                    <div class="weather-date" id="currentDate">Loading date...</div>
                    <div class="weather-temp" id="currentTemp">--°C</div>
                </div>
                <div class="weather-details">
                    <div class="weather-condition" id="weatherCondition">Loading...</div>
                    <div class="weather-range" id="weatherRange">--°C / --°C</div>
                </div>
            </div>

            <h2 style="margin: 30px 0 20px; font-family: 'Poppins', sans-serif; color: #4CAF50;">Quick Actions</h2>
            
            <div class="features">
                <!-- Fertilizer Calculator Card -->
                <div class="feature-card" id="fertilizerCard">
                    <div class="feature-header">
                        <div class="feature-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <h2 class="feature-title">Fertilizer Calculator</h2>
                    </div>
                    <p class="feature-desc">Calculate the right amount of fertilizer for your crops based on area and soil conditions.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> Crop-specific recommendations</li>
                        <li><i class="fas fa-check"></i> Soil nutrient analysis</li>
                        <li><i class="fas fa-check"></i> Cost estimation</li>
                    </ul>
                </div>

                <!-- Pest Control Card -->
                <div class="feature-card" id="pestControlCard">
                    <div class="feature-header">
                        <div class="feature-icon">
                            <i class="fas fa-bug"></i>
                        </div>
                        <h2 class="feature-title">Pest Control</h2>
                    </div>
                    <p class="feature-desc">Identify pests and get recommendations for safe and effective control measures.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> Pesticide calculator</li>
                        <li><i class="fas fa-check"></i> Expert tips</li>
                        <li><i class="fas fa-check"></i> Safety guidelines</li>
                    </ul>
                </div>

                <!-- Video Library Card -->
                <div class="feature-card" id="videoLibraryCard">
                    <div class="feature-header">
                        <div class="feature-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <h2 class="feature-title">Video Library</h2>
                    </div>
                    <p class="feature-desc">Access educational videos, farmer uploads, and product demonstrations.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> Farming tutorials</li>
                        <li><i class="fas fa-check"></i> Community uploads</li>
                        <li><i class="fas fa-check"></i> Product reviews</li>
                    </ul>
                </div>
            </div>

            <!-- Fertilizer Calculator Section (Hidden by default) -->
            <div class="calculator-section" id="fertilizerCalculator">
                <div class="feature-card">
                    <h2 class="feature-title" style="margin-bottom: 20px;">Fertilizer Calculator</h2>
                    
                    <div class="form-group">
                        <label for="fert-crop">Crop</label>
                        <select id="fert-crop">
                            <option value="rice">Rice</option>
                            <option value="wheat">Wheat</option>
                            <option value="maize">Maize</option>
                            <option value="cotton">Cotton</option>
                            <option value="sugarcane">Sugarcane</option>
                            <option value="tomato">Tomato</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label for="fert-area">Area</label>
                            <input id="fert-area" type="number" min="0" step="0.01" placeholder="e.g., 1" />
                        </div>
                        <div style="width: 135px">
                            <label for="fert-unit">Unit</label>
                            <select id="fert-unit">
                                <option value="ha">Hectares</option>
                                <option value="acre">Acres</option>
                                <option value="m2">m²</option>
                            </select>
                        </div>
                    </div>

                    <label>Optional: Soil Test (N, P, K in kg/ha)</label>
                    <div class="row">
                        <input id="soil-n" type="number" placeholder="N" min="0" class="col" />
                        <input id="soil-p" type="number" placeholder="P" min="0" class="col" />
                        <input id="soil-k" type="number" placeholder="K" min="0" class="col" />
                    </div>

                    <div class="btn-group">
                        <button id="fert-calc" class="btn btn-primary">Calculate</button>
                        <button id="fert-save" class="btn btn-secondary">Save Result</button>
                        <button id="fert-reset" class="btn btn-secondary">Reset</button>
                        <button id="fert-explain-toggle" class="btn btn-secondary">Why this amount?</button>
                    </div>

                    <div id="fert-result" class="results">
                        <div class="result-item" id="fert-summary"></div>
                        <div id="fert-breakdown" style="margin-top: 8px"></div>
                        <div id="fert-schedule" style="margin-top: 10px"></div>
                        <div style="margin-top: 10px; color: #4CAF50; font-weight: 600;" id="fert-saved-note" style="display: none">Saved to browser localStorage.</div>
                    </div>

                    <div id="fert-explain" style="display: none; margin-top: 15px; padding: 10px; background-color: #E8F5E9; border-radius: 5px;"></div>
                </div>
            </div>

            <!-- Pest Control Section (Hidden by default) -->
            <div class="calculator-section" id="pestControlCalculator">
                <div class="feature-card">
                    <h2 class="feature-title" style="margin-bottom: 20px;">Pest Calculator & Tips</h2>
                    
                    <div class="form-group">
                        <label for="pest-crop">Crop</label>
                        <select id="pest-crop">
                            <option value="rice">Rice</option>
                            <option value="wheat">Wheat</option>
                            <option value="maize">Maize</option>
                            <option value="cotton">Cotton</option>
                            <option value="tomato">Tomato</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="pest-type">Pest / Disease Type</label>
                        <select id="pest-type">
                            <option value="stem_borer">Stem Borer</option>
                            <option value="aphids">Aphids</option>
                            <option value="blast">Blast (fungus)</option>
                            <option value="bollworm">Bollworm</option>
                            <option value="leaf_mite">Leaf Mite</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label for="infected-percent">Estimated infected area (%)</label>
                            <input id="infected-percent" type="number" min="0" max="100" step="1" placeholder="e.g., 10" />
                        </div>
                        <div style="width: 160px">
                            <label for="area-pest">Area unit</label>
                            <select id="area-pest">
                                <option value="ha">Hectares</option>
                                <option value="acre">Acres</option>
                                <option value="m2">m²</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label for="total-area">Total area (same unit)</label>
                            <input id="total-area" type="number" min="0" step="0.01" placeholder="e.g., 1.5" />
                        </div>
                        <div style="width: 160px">
                            <label for="tank-size">Spray tank size (litres)</label>
                            <input id="tank-size" type="number" min="1" step="1" value="200" />
                        </div>
                    </div>

                    <div style="margin-top: 8px; color: #666; font-size: 0.9rem;">Area that one full tank covers (ha). Change if you know exact coverage per tank.</div>
                    <div class="row" style="margin-top: 6px">
                        <div style="width: 160px">
                            <label for="area-per-tank">Area per tank (ha)</label>
                            <input id="area-per-tank" type="number" min="0.001" step="0.001" value="0.1" />
                        </div>
                        <div style="flex: 1">
                            <label for="pesticide-strength">Formulation strength (%)</label>
                            <input id="pesticide-strength" type="number" min="0.1" step="0.1" value="36" />
                        </div>
                    </div>

                    <div class="btn-group">
                        <button id="pest-calc" class="btn btn-primary">Calculate Dose</button>
                        <button id="pest-reset" class="btn btn-secondary">Reset</button>
                    </div>

                    <div id="pest-result" class="results">
                        <div id="pest-summary" class="result-item"></div>
                        <div id="pest-breakdown" style="margin-top: 8px"></div>
                        <div style="margin-top: 8px; padding: 10px; background-color: #FFEBEE; border-radius: 5px;" id="pest-safety"></div>
                    </div>

                    <!-- Enhanced Tips Section -->
                    <div class="tips-section">
                        <h3 style="margin-bottom: 15px; color: #4CAF50;">Pest Management Tips</h3>
                        
                        <div class="tip-item">
                            <div class="tip-title">Early Detection</div>
                            <div>Regularly inspect crops for signs of pests. Early detection allows for more effective and less invasive control methods.</div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-title">Cultural Controls</div>
                            <div>Practice crop rotation, intercropping, and proper sanitation to disrupt pest life cycles and reduce infestations.</div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-title">Biological Controls</div>
                            <div>Introduce natural predators like ladybugs for aphids or use biopesticides derived from natural materials.</div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-title">Chemical Controls</div>
                            <div>Use pesticides as a last resort. Always follow label instructions, wear proper PPE, and observe pre-harvest intervals.</div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-title">Resistance Management</div>
                            <div>Rotate pesticide classes to prevent pests from developing resistance to specific chemicals.</div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-title">Integrated Pest Management (IPM)</div>
                            <div>Combine multiple control strategies for sustainable pest management that minimizes economic, health, and environmental risks.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Video Library Section (Hidden by default) -->
            <div class="calculator-section" id="videoLibrarySection">
                <div class="feature-card">
                    <h2 class="feature-title" style="margin-bottom: 20px;">Video Library</h2>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="featured">Featured</div>
                        <div class="tab" data-tab="youtube">YouTube</div>
                    </div>

                    <div class="tab-content active" id="featuredTab">
                        <div class="video-grid" id="featuredVideos">
                            <!-- Videos will be loaded here -->
                        </div>
                    </div>

                    <div class="tab-content" id="youtubeTab">
                        <div class="form-group">
                            <label for="youtubeSearch">Search YouTube for farming videos</label>
                            <div class="row">
                                <input type="text" id="youtubeSearch" placeholder="Enter search terms..." class="col">
                                <button id="searchYoutube" class="btn btn-primary">Search</button>
                            </div>
                        </div>
                        <div class="video-grid" id="youtubeVideos">
                            <!-- YouTube videos will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unavailable Pages -->
        <div id="healCropsPage" class="page unavailable-page" style="display: none;">
            <div class="unavailable-icon">
                <i class="fas fa-heartbeat"></i>
            </div>
            <h2 class="unavailable-title">Crop Health Diagnostic</h2>
            <p class="unavailable-text">The crop health diagnostic feature is currently unavailable. Our AI-powered disease detection system is being enhanced for better accuracy.</p>
            <button class="btn btn-primary back-to-home">Back to Home</button>
        </div>

        <div id="communityPage" class="page unavailable-page" style="display: none;">
            <div class="unavailable-icon">
                <i class="fas fa-users"></i>
            </div>
            <h2 class="unavailable-title">Community Feature</h2>
            <p class="unavailable-text">The community feature is currently unavailable. Our team is working hard to bring farmers together in a collaborative space.</p>
            <button class="btn btn-primary back-to-home">Back to Home</button>
        </div>

        <div id="marketPage" class="page unavailable-page" style="display: none;">
            <div class="unavailable-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <h2 class="unavailable-title">Marketplace</h2>
            <p class="unavailable-text">The marketplace feature is currently under development. Soon you'll be able to buy and sell agricultural products directly.</p>
            <button class="btn btn-primary back-to-home">Back to Home</button>
        </div>

        <div id="profilePage" class="page unavailable-page" style="display: none;">
            <div class="unavailable-icon">
                <i class="fas fa-user"></i>
            </div>
            <h2 class="unavailable-title">Profile Section</h2>
            <p class="unavailable-text">The profile management feature is currently unavailable. We're building a comprehensive profile system for farmers.</p>
            <button class="btn btn-primary back-to-home">Back to Home</button>
        </div>
    </div>

    <!-- Chat Widget Toggle -->
    <div class="chat-widget-toggle" id="chatToggle">
        <i class="fas fa-comments"></i>
    </div>

    <!-- Video Modal -->
    <div class="modal" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="videoModalTitle">Video</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div id="videoPlayer" style="width: 100%; height: 400px; background-color: #000;"></div>
        </div>
    </div>

    <!-- Chatbase Chatbot Script -->
    <script>
        (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="7pFdedNB2Kz1zUtlvlJte";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
    </script>

    <script>
        // Dynamic redirect function
        function redirectTo(page, delay = 0) {
            setTimeout(() => {
                if (window.location.href.startsWith("file:") || window.location.href.includes("5500")) {
                    // VS Code Live Server / direct HTML
                    window.location.href = page + ".html";
                } else {
                    // Flask routes
                    window.location.href = "/" + page;
                }
            }, delay);
        }

        // YouTube API Key
        const YOUTUBE_API_KEY = 'AIzaSyCZ-227I52Mb7I3VvWWu52C9zr77F4p1Dg';
        
        // Fertilizer logic (from reference code)
        function toHectares(value, unit){
            if (!value || isNaN(value) || value <= 0) return 0;
            value = Number(value);
            switch(unit){
                case 'ha': return value;
                case 'acre': return value * 0.40468564224;
                case 'm2': return value / 10000;
                default: return value;
            }
        }

        function round(x, dp=2){ 
            return Math.round((x + Number.EPSILON) * Math.pow(10,dp)) / Math.pow(10,dp); 
        }

        // Base recommendations (kg nutrient per hectare)
        const baseNPKperHa = {
            rice: {N:120, P:60, K:60},
            wheat: {N:100, P:50, K:40},
            maize: {N:140, P:60, K:50},
            cotton: {N:100, P:60, K:60},
            sugarcane: {N:150, P:70, K:200},
            tomato: {N:120, P:70, K:80}
        };

        // Fertilizer formulations & prices
        const fertilizers = [
            { code:'urea', name:'Urea (46% N)', nutrient:'N', pct:46, pricePerKg:30 },
            { code:'dap',  name:'DAP (18% N, 46% P2O5 ~ 20% P)', nutrient:'P', pct:20, pricePerKg:45 },
            { code:'mop',  name:'MOP (60% K2O ~ 50% K)', nutrient:'K', pct:50, pricePerKg:25 }
        ];

        function calcFertilizerRecommendation(crop, areaHa, soil){
            const base = baseNPKperHa[crop];
            if(!base) return null;

            const reqN = Math.max(0, base.N - (soil?.N || 0));
            const reqP = Math.max(0, base.P - (soil?.P || 0));
            const reqK = Math.max(0, base.K - (soil?.K || 0));

            const totN = reqN * areaHa;
            const totP = reqP * areaHa;
            const totK = reqK * areaHa;

            const ureaKg = totN / (fertilizers.find(f=>f.code==='urea').pct/100);
            const dapKg  = totP / (fertilizers.find(f=>f.code==='dap').pct/100);
            const mopKg  = totK / (fertilizers.find(f=>f.code==='mop').pct/100);

            const schedule = [
                { when: 'Basal (before/at sowing)', items: [{name:'DAP', kg: round(dapKg,2)}, {name:'MOP', kg: round(mopKg,2)}] },
                { when: 'Top-dressing (1)', items: [{name:'Urea', kg: round(ureaKg*0.6,2)}] },
                { when: 'Top-dressing (2)', items: [{name:'Urea', kg: round(ureaKg*0.4,2)}] }
            ];

            const totalCost = round(
                ureaKg * fertilizers.find(f=>f.code==='urea').pricePerKg +
                dapKg  * fertilizers.find(f=>f.code==='dap').pricePerKg +
                mopKg  * fertilizers.find(f=>f.code==='mop').pricePerKg, 2
            );

            return {
                areaHa,
                reqN, reqP, reqK,
                totals: { ureaKg: round(ureaKg,2), dapKg: round(dapKg,2), mopKg: round(mopKg,2) },
                schedule, totalCost
            };
        }

        // Pest logic
        const pestDefaults = {
            stem_borer: { name:'Stem Borer', mlPerHa: 300 },
            aphids:     { name:'Aphids', mlPerHa: 250 },
            blast:      { name:'Blast (fungus)', mlPerHa: 400 },
            bollworm:   { name:'Bollworm', mlPerHa: 350 },
            leaf_mite:  { name:'Leaf Mite', mlPerHa: 200 }
        };

        // Utility: build YouTube link
        function youtubeLink(videoId) {
            return `https://www.youtube.com/watch?v=${encodeURIComponent(videoId)}`;
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Update date and weather
            updateDate();
            updateWeather();
            getUserLocation();
            
            // Navigation setup
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    
                    if (page === 'home') {
                        showPage('homePage');
                        hideAllCalculators();
                        setActiveNav('home');
                    } else {
                        redirectTo(page);
                    }
                });
            });
            
            // Feature card clicks - show calculators
            document.getElementById('fertilizerCard').addEventListener('click', function() {
                hideAllCalculators();
                document.getElementById('fertilizerCalculator').classList.add('active');
                document.getElementById('fertilizerCalculator').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('pestControlCard').addEventListener('click', function() {
                hideAllCalculators();
                document.getElementById('pestControlCalculator').classList.add('active');
                document.getElementById('pestControlCalculator').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('videoLibraryCard').addEventListener('click', function() {
                hideAllCalculators();
                document.getElementById('videoLibrarySection').classList.add('active');
                document.getElementById('videoLibrarySection').scrollIntoView({ behavior: 'smooth' });
                loadFeaturedVideos();
            });
            
            // Back to home buttons
            document.querySelectorAll('.back-to-home').forEach(button => {
                button.addEventListener('click', function() {
                    showPage('homePage');
                    setActiveNav('home');
                    hideAllCalculators();
                });
            });
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    document.getElementById(tabName + 'Tab').classList.add('active');
                    
                    // Load videos when YouTube tab is selected
                    if (tabName === 'youtube') {
                        loadYouTubeVideos('farming techniques');
                    }
                });
            });
            
            // Fertilizer calculator functionality
            document.getElementById('fert-calc').addEventListener('click', function() {
                const crop = document.getElementById('fert-crop').value;
                const areaVal = parseFloat(document.getElementById('fert-area').value);
                const unit = document.getElementById('fert-unit').value;
                
                if(!areaVal || areaVal <= 0){ 
                    alert('Enter a valid area'); 
                    return; 
                }
                
                const areaHa = toHectares(areaVal, unit);

                const soil = {};
                const nVal = Number(document.getElementById('soil-n').value); 
                if(nVal) soil.N = nVal;
                const pVal = Number(document.getElementById('soil-p').value); 
                if(pVal) soil.P = pVal;
                const kVal = Number(document.getElementById('soil-k').value); 
                if(kVal) soil.K = kVal;

                const rec = calcFertilizerRecommendation(crop, areaHa, (Object.keys(soil).length?soil:null));
                if(!rec){ 
                    alert('No recommendation logic for selected crop'); 
                    return; 
                }

                document.getElementById('fert-summary').innerHTML = `For <strong>${areaVal} ${unit} of ${crop}</strong> (≈ ${round(areaHa,4)} ha)`;
                document.getElementById('fert-breakdown').innerHTML = `
                    <div><strong>Recommended fertilizer (total):</strong></div>
                    <div class="result-item">Urea: ${rec.totals.ureaKg} kg</div>
                    <div class="result-item">DAP: ${rec.totals.dapKg} kg</div>
                    <div class="result-item">MOP: ${rec.totals.mopKg} kg</div>
                    <div style="margin-top:8px"><strong>Estimated cost:</strong> ₹ ${rec.totalCost}</div>
                `;
                
                let schedHtml = '<strong>Application schedule:</strong><ul style="padding-left:16px">';
                rec.schedule.forEach(s=>{
                    schedHtml += `<li style="margin:6px 0"><strong>${s.when}:</strong> ${s.items.map(it => `${it.name} ${it.kg} kg`).join(', ')}</li>`;
                });
                schedHtml += '</ul>';
                document.getElementById('fert-schedule').innerHTML = schedHtml;
                
                document.getElementById('fert-explain').innerText = `Calculation: base nutrient need (kg/ha) for ${crop} multiplied by area → subtract soil test values (if provided). Then nutrient mass converted to fertilizer mass using typical formulation percentages. Prices are sample values.`;
                
                document.getElementById('fert-result').classList.add('active');
                document.getElementById('fert-saved-note').style.display = 'none';
            });
            
            document.getElementById('fert-reset').addEventListener('click', function() {
                document.getElementById('fert-area').value = '';
                document.getElementById('soil-n').value = '';
                document.getElementById('soil-p').value = '';
                document.getElementById('soil-k').value = '';
                document.getElementById('fert-result').classList.remove('active');
                document.getElementById('fert-saved-note').style.display = 'none';
            });
            
            document.getElementById('fert-explain-toggle').addEventListener('click', function() {
                const explanation = document.getElementById('fert-explain');
                explanation.style.display = explanation.style.display === 'none' ? 'block' : 'none';
            });
            
            // Pest control functionality
            document.getElementById('pest-calc').addEventListener('click', function() {
                const crop = document.getElementById('pest-crop').value;
                const pest = document.getElementById('pest-type').value;
                const infectedPct = Number(document.getElementById('infected-percent').value) || 0;
                const unit = document.getElementById('area-pest').value;
                const areaVal = Number(document.getElementById('total-area').value);
                
                if(!areaVal || areaVal <= 0){ 
                    alert('Enter total area to treat'); 
                    return; 
                }
                
                const areaHa = toHectares(areaVal, unit);
                const affectedHa = areaHa * (Math.min(100, Math.max(0, infectedPct)) / 100 );

                const def = pestDefaults[pest];
                if(!def){ 
                    alert('No defaults for this pest'); 
                    return; 
                }
                
                const mlPerHa = def.mlPerHa;
                const totalMl = mlPerHa * affectedHa;

                const areaPerTank = Number(document.getElementById('area-per-tank').value) || 0.1;
                const tankSize = Number(document.getElementById('tank-size').value) || 200;
                const perTankMl = mlPerHa * areaPerTank;

                const formattedTotal = round(totalMl,2);
                const formattedPerTank = round(perTankMl,2);

                document.getElementById('pest-summary').innerHTML = `Pest: <strong>${def.name}</strong> on <strong>${round(affectedHa,3)} ha</strong> affected area.`;
                document.getElementById('pest-breakdown').innerHTML = `
                    <div><strong>Recommended formulation:</strong> ${mlPerHa} ml per hectare</div>
                    <div style="margin-top:8px"><strong>Total pesticide required:</strong> ${formattedTotal} ml (for ${round(affectedHa,3)} ha)</div>
                    <div><strong>Mix per tank (tank size ${tankSize} L, covers ${areaPerTank} ha):</strong> ${formattedPerTank} ml per full tank</div>
                    <div style="margin-top:6px"><strong>Number of full tanks needed:</strong> ${ areaPerTank>0 ? round(affectedHa/areaPerTank,2) : '—' }</div>
                `;

                document.getElementById('pest-safety').innerHTML = `<strong>Safety:</strong> Wear PPE, avoid spraying under windy conditions, follow label waiting period. Formulation strength input is for reference only — always follow the registered product label.`;

                document.getElementById('pest-result').classList.add('active');
            });
            
            document.getElementById('pest-reset').addEventListener('click', function() {
                document.getElementById('infected-percent').value = '';
                document.getElementById('total-area').value = '';
                document.getElementById('tank-size').value = '200';
                document.getElementById('area-per-tank').value = '0.1';
                document.getElementById('pesticide-strength').value = '36';
                document.getElementById('pest-result').classList.remove('active');
            });
            
            // YouTube search
            document.getElementById('searchYoutube').addEventListener('click', function() {
                const query = document.getElementById('youtubeSearch').value;
                if (query) {
                    loadYouTubeVideos(query);
                }
            });
        });
        
        // Update date function
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }
        
        // Get user location with improved accuracy
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        // Use reverse geocoding API to get location name
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Using OpenStreetMap Nominatim API for reverse geocoding
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data && data.address) {
                                    const address = data.address;
                                    let locationName = '';
                                    
                                    // Try to get the most specific location name
                                    if (address.city) {
                                        locationName = address.city;
                                    } else if (address.town) {
                                        locationName = address.town;
                                    } else if (address.village) {
                                        locationName = address.village;
                                    } else if (address.county) {
                                        locationName = address.county;
                                    } else if (address.state) {
                                        locationName = address.state;
                                    } else {
                                        locationName = 'Your Location';
                                    }
                                    
                                    // Add state if available
                                    if (address.state && locationName !== address.state) {
                                        locationName += `, ${address.state}`;
                                    }
                                    
                                    document.getElementById('userLocation').textContent = locationName;
                                    document.getElementById('currentLocation').textContent = locationName;
                                } else {
                                    setDefaultLocation();
                                }
                            })
                            .catch(error => {
                                console.error('Error getting location:', error);
                                setDefaultLocation();
                            });
                    },
                    function(error) {
                        console.error('Geolocation error:', error);
                        setDefaultLocation();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            } else {
                setDefaultLocation();
            }
        }
        
        // Set default location
        function setDefaultLocation() {
            document.getElementById('userLocation').textContent = 'Chennai, Tamil Nadu';
            document.getElementById('currentLocation').textContent = 'Chennai';
        }
        
        // Update weather function (simulated)
        function updateWeather() {
            // In a real implementation, this would fetch from a weather API
            const temperatures = [28, 29, 30, 31, 32, 33, 34, 35];
            const conditions = ['Moderate', 'Partly Cloudy', 'Cloudy', 'Rainy'];
            const minTemp = 27;
            const maxTemp = 35;
            
            // Simulate random weather data
            const randomTemp = temperatures[Math.floor(Math.random() * temperatures.length)];
            const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
            
            document.getElementById('currentTemp').textContent = `${randomTemp}°C`;
            document.getElementById('weatherCondition').textContent = randomCondition;
            document.getElementById('weatherRange').textContent = `${minTemp}°C / ${maxTemp}°C`;
        }
        
        // Hide all calculators
        function hideAllCalculators() {
            document.querySelectorAll('.calculator-section').forEach(section => {
                section.classList.remove('active');
            });
        }
        
        // Load featured videos
        function loadFeaturedVideos() {
            const featuredVideosContainer = document.getElementById('featuredVideos');
            featuredVideosContainer.innerHTML = '';

            // Sample featured videos (farming-based)
            const featuredVideos = [
                {
                    title: 'Organic Farming Basics',
                    videoId: 'quMNdpNatuM',
                    thumbnail: 'https://img.youtube.com/vi/quMNdpNatuM/hqdefault.jpg',
                    duration: '15:30',
                    channel: 'AgriExpert'
                },
                {
                    title: 'Soil Health Management Tips',
                    videoId: '0js09p2s0Lc',
                    thumbnail: 'https://img.youtube.com/vi/0js09p2s0Lc/hqdefault.jpg',
                    duration: '22:15',
                    channel: 'FarmTech'
                },
                {
                    title: 'Modern Irrigation Techniques',
                    videoId: 'Blb0_8ZcMwc',
                    thumbnail: 'https://img.youtube.com/vi/Blb0_8ZcMwc/hqdefault.jpg',
                    duration: '18:45',
                    channel: 'WaterWise'
                },
                {
                    title: 'Effective Pest Control Strategies',
                    videoId: 'JXEtmKRnMZk',
                    thumbnail: 'https://img.youtube.com/vi/JXEtmKRnMZk/hqdefault.jpg',
                    duration: '12:20',
                    channel: 'CropCare'
                }
            ];

            featuredVideos.forEach(video => {
                const videoCard = createVideoCard(video);
                featuredVideosContainer.appendChild(videoCard);
            });
        }

        // Load YouTube videos dynamically (simulated)
        function loadYouTubeVideos(query) {
            const youtubeVideosContainer = document.getElementById('youtubeVideos');
            youtubeVideosContainer.innerHTML = '<div style="text-align: center; padding: 20px;">Loading videos...</div>';

            // Simulate API call with sample data
            setTimeout(() => {
                youtubeVideosContainer.innerHTML = '';

                const youtubeVideos = [
                    {
                        title: `${query} - Farming in India`,
                        videoId: 'nNP4o1wE6Vo',
                        thumbnail: 'https://img.youtube.com/vi/nNP4o1wE6Vo/hqdefault.jpg',
                        duration: '10:25',
                        channel: 'YouTube Farmer'
                    },
                    {
                        title: `Advanced ${query} Techniques`,
                        videoId: 'jOv9JGGPhoQ',
                        thumbnail: 'https://img.youtube.com/vi/jOv9JGGPhoQ/hqdefault.jpg',
                        duration: '15:40',
                        channel: 'AgriPro'
                    },
                    {
                        title: `${query} for Beginners`,
                        videoId: '2F74xw1VK8E',
                        thumbnail: 'https://img.youtube.com/vi/2F74xw1VK8E/hqdefault.jpg',
                        duration: '8:15',
                        channel: 'Farming 101'
                    },
                    {
                        title: `Modern ${query} Methods`,
                        videoId: 'zeSRhgRSRJI',
                        thumbnail: 'https://img.youtube.com/vi/zeSRhgRSRJI/hqdefault.jpg',
                        duration: '12:30',
                        channel: 'Future Farms'
                    }
                ];

                youtubeVideos.forEach(video => {
                    const videoCard = createVideoCard(video);
                    youtubeVideosContainer.appendChild(videoCard);
                });
            }, 1000);
        }

        // Create video card element
        function createVideoCard(video) {
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            
            // Create a wrapper link that opens the video in a new tab
            const videoLink = document.createElement('a');
            videoLink.href = youtubeLink(video.videoId);
            videoLink.target = '_blank';
            videoLink.rel = 'noopener noreferrer';
            videoLink.style.textDecoration = 'none';
            videoLink.style.color = 'inherit';
            videoLink.style.display = 'block';
            
            videoLink.innerHTML = `
                <div class="video-thumbnail" style="position:relative;">
                    <img src="${video.thumbnail}" alt="${video.title}">
                    <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 0.7rem;">
                        ${video.duration}
                    </div>
                </div>
                <div class="video-info">
                    <div class="video-title">${video.title}</div>
                    <div class="video-meta">${video.channel}</div>
                </div>
            `;

            videoCard.appendChild(videoLink);
            
            // Keep the modal functionality for a better user experience
            videoCard.addEventListener('click', function(e) {
                // Only open modal if the link wasn't clicked directly
                if (!e.target.closest('a')) {
                    openVideoModal(video);
                }
            });

            return videoCard;
        }

        // Open video modal
        function openVideoModal(video) {
            const modal = document.getElementById('videoModal');
            const title = modal.querySelector('.modal-title');
            const iframe = modal.querySelector('#videoPlayer');

            title.textContent = video.title;
            iframe.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${video.videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            modal.style.display = 'flex';
        }

        // Close modal
        document.querySelector('.close-modal').addEventListener('click', function() {
            closeVideoModal();
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === document.getElementById('videoModal')) {
                closeVideoModal();
            }
        });

        // Close video modal function
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const iframe = modal.querySelector('#videoPlayer');

            iframe.innerHTML = ''; // clears the video so it stops playing
            modal.style.display = 'none';
        }

        // Show specific page
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });

            document.getElementById(pageId).style.display = 'block';
        }

        // Set active navigation item
        function setActiveNav(activePage) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.querySelector(`.nav-item[data-page="${activePage}"]`).classList.add('active');
        }
    </script>
</body>
</html>